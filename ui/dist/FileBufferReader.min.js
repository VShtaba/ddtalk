"use strict";!function(){var e={ConvertToArrayBuffer:function(e,n){l.pack(e,function(e){n(e.buffer)})},ConvertToObject:function(e,n){l.unpack(e,n)}};var n=Uint8Array.BYTES_PER_ELEMENT,t=Uint16Array.BYTES_PER_ELEMENT,r=Uint32Array.BYTES_PER_ELEMENT,i={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},a=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],o=function(e){var o=0,c=0,u=0,s=new ArrayBuffer(e[0].byte_length+e[0].header_size),f=new DataView(s);for(c=0;c<e.length;c++){e[c].header_size;var l=e[c].type,A=e[c].length,d=e[c].value,R=e[c].byte_length,h=a[l],v=null===h?0:window[h+"Array"].BYTES_PER_ELEMENT;switch(l===i.BUFFER?f.setUint8(o,i.BLOB,!1):f.setUint8(o,l,!1),o+=n,l!==i.ARRAY&&l!==i.OBJECT||(f.setUint16(o,A,!1),o+=t),f.setUint32(o,R,!1),o+=r,l){case i.NULL:case i.UNDEFINED:break;case i.STRING:for(u=0;u<A;u++,o+=v)f.setUint16(o,d.charCodeAt(u),!1);break;case i.NUMBER:case i.BOOLEAN:0,f["set"+h](o,d,!1),o+=v;break;case i.INT8ARRAY:case i.INT16ARRAY:case i.INT32ARRAY:case i.UINT8ARRAY:case i.UINT16ARRAY:case i.UINT32ARRAY:case i.FLOAT32ARRAY:case i.FLOAT64ARRAY:new Uint8Array(f.buffer,o,R).set(new Uint8Array(d.buffer)),o+=R;break;case i.ARRAYBUFFER:case i.BUFFER:new Uint8Array(f.buffer,o,R).set(new Uint8Array(d)),o+=R;break;case i.BLOB:case i.ARRAY:case i.OBJECT:break;default:throw"TypeError: Unexpected type found."}0}return f},c=function(e,o){var u,s,f,l,A,d=0;u=e.getUint8(o,!1),o+=n,u!==i.ARRAY&&u!==i.OBJECT||(s=e.getUint16(o,!1),o+=t),f=e.getUint32(o,!1),o+=r;var R=a[u],h=null===R?0:window[R+"Array"].BYTES_PER_ELEMENT;switch(u){case i.NULL:case i.UNDEFINED:0,l=null;break;case i.STRING:s=f/h;var v=[];for(d=0;d<s;d++){var E=e.getUint16(o,!1);o+=h,v.push(String.fromCharCode(E))}l=v.join("");break;case i.NUMBER:l=e.getFloat64(o,!1),o+=h;break;case i.BOOLEAN:l=1===e.getUint8(o,!1),o+=h;break;case i.INT8ARRAY:case i.INT16ARRAY:case i.INT32ARRAY:case i.UINT8ARRAY:case i.UINT16ARRAY:case i.UINT32ARRAY:case i.FLOAT32ARRAY:case i.FLOAT64ARRAY:case i.ARRAYBUFFER:A=e.buffer.slice(o,o+f),o+=f,l=u===i.ARRAYBUFFER?A:new window[R+"Array"](A);break;case i.BLOB:if(window.Blob){var y=c(e,o),U=c(e,y.cursor);o=U.cursor,l=new Blob([U.value],{type:y.value})}else A=e.buffer.slice(o,o+f),o+=f,l=new Buffer(A);break;case i.ARRAY:for(l=[],d=0;d<s;d++)o=(A=c(e,o)).cursor,l.push(A.value);break;case i.OBJECT:for(l={},d=0;d<s;d++){var T=c(e,o),k=c(e,T.cursor);o=k.cursor,l[T.value]=k.value}break;default:throw"TypeError: Type not supported."}return{value:l,cursor:o}},u=function(e,n){for(var t=e.length,r=[],i=0,a=0,o=0;o<e.length;o++)!function(o){s(e[o],function(e){if(r[o]=e,a+=e[0].header_size+e[0].byte_length,++i===t){for(var c=[],u=0;u<r.length;u++)c=c.concat(r[u]);n(c,a)}})}(o)},s=function(e,o){var c,s,f=n+r,l=0,A=0,d=e;switch(s=function(e){var n=void 0;if(void 0===e)n=i.UNDEFINED;else if(null===e)n=i.NULL;else{var t=e.constructor.name,r=e.constructor.toString().match(/\w+/g)[1];if(void 0!==t&&void 0!==i[t.toUpperCase()])n=i[t.toUpperCase()];else if(void 0!==r&&void 0!==i[r.toUpperCase()])n=i[r.toUpperCase()];else switch(typeof e){case"string":n=i.STRING;break;case"number":n=i.NUMBER;break;case"boolean":n=i.BOOLEAN;break;case"object":e instanceof Array?n=i.ARRAY:e instanceof Int8Array?n=i.INT8ARRAY:e instanceof Int16Array?n=i.INT16ARRAY:e instanceof Int32Array?n=i.INT32ARRAY:e instanceof Uint8Array?n=i.UINT8ARRAY:e instanceof Uint16Array?n=i.UINT16ARRAY:e instanceof Uint32Array?n=i.UINT32ARRAY:e instanceof Float32Array?n=i.FLOAT32ARRAY:e instanceof Float64Array?n=i.FLOAT64ARRAY:e instanceof ArrayBuffer?n=i.ARRAYBUFFER:e instanceof Blob?n=i.BLOB:e instanceof Buffer?n=i.BUFFER:e instanceof Object&&(n=i.OBJECT)}}return n}(e),c=void 0===a[s]||null===a[s]?0:window[a[s]+"Array"].BYTES_PER_ELEMENT,s){case i.UNDEFINED:case i.NULL:break;case i.NUMBER:case i.BOOLEAN:l=c;break;case i.STRING:l+=(A=e.length)*c;break;case i.INT8ARRAY:case i.INT16ARRAY:case i.INT32ARRAY:case i.UINT8ARRAY:case i.UINT16ARRAY:case i.UINT32ARRAY:case i.FLOAT32ARRAY:case i.FLOAT64ARRAY:l+=(A=e.length)*c;break;case i.ARRAY:return void u(e,function(n,r){o([{type:s,length:e.length,header_size:f+t,byte_length:r,value:null}].concat(n))});case i.OBJECT:var R=[];for(var h in e)e.hasOwnProperty(h)&&(R.push(h),R.push(e[h]),A++);return void u(R,function(e,n){o([{type:s,length:A,header_size:f+t,byte_length:n,value:null}].concat(e))});case i.ARRAYBUFFER:l+=e.byteLength;break;case i.BLOB:var v=e.type,E=new FileReader;return E.onload=function(e){u([v,e.target.result],function(e,n){o([{type:s,length:A,header_size:f,byte_length:n,value:null}].concat(e))})},E.onerror=function(e){throw"FileReader Error: "+e},void E.readAsArrayBuffer(e);case i.BUFFER:l+=e.length;break;default:throw'TypeError: Type "'+e.constructor.name+'" not supported.'}o([{type:s,length:A,header_size:f,byte_length:l,value:d}].concat([]))},f=function(e,n){var t=e instanceof DataView?e:new DataView(e);return c(t,0).value};var l={pack:function(e,n){try{0,s(e,function(e){n(o(e))})}catch(e){throw e}},unpack:function(e,n){try{0;var t=f(e);0,n(t)}catch(e){throw e}}};window.FileConverter=e,window.FileSelector=function(){var e=this,n=function(){};function t(t,r,i){t=t||function(){};var a=document.createElement("input");a.type="file",r&&(a.multiple=!0),i&&(a.webkitdirectory=!0),a.accept=e.accept,a.onclick=function(){a.clickStarted=!0},document.body.onfocus=function(){setTimeout(function(){a.clickStarted&&(a.clickStarted=!1,a.value||n())},500)},a.onchange=function(){if(r){if(!a.files.length)return void console.error("No file selected.");var e=[];return Array.from(a.files).forEach(function(n){n.url=n.webkitRelativePath,e.push(n)}),void t(e)}a.files[0]?(t(a.files[0]),a.parentNode.removeChild(a)):console.error("No file selected.")},a.style.display="none",(document.body||document.documentElement).appendChild(a),function(e){if("function"!=typeof e.click)if("function"!=typeof e.change){if(void 0!==document.createEvent("Event")){var n=document.createEvent("Event");if("function"==typeof n.initEvent&&"function"==typeof e.dispatchEvent)return n.initEvent("click",!0,!0),void e.dispatchEvent(n)}var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(n)}else e.change();else e.click()}(a)}e.selectSingleFile=function(e,r){r&&(n=r),t(e)},e.selectMultipleFiles=function(e,r){r&&(n=r),t(e,!0)},e.selectDirectory=function(e,r){r&&(n=r),t(e,!0,!0)},e.accept="*.*"},window.FileBufferReader=function(){var n=this,t=new function(){function e(e,n){n=n||function(e){postMessage(e)};var t=e.file;t.uuid||(t.uuid=(100*Math.random()).toString().replace(/\./g,""));var r=e.chunkSize||15e3;e.extra&&e.extra.chunkSize&&(r=e.extra.chunkSize);var i,a=0,o=r,c=Math.floor(Math.min(1e8,o)/r),u=c*r,s=Math.ceil(t.size/r);t.maxChunks=s;var f=0,l=[];n({currentPosition:f,uuid:t.uuid,maxChunks:s,size:t.size,name:t.name,type:t.type,lastModifiedDate:(t.lastModifiedDate||new Date).toString(),start:!0});var A,d=new FileReader;d.onloadend=function(e){e.target.readyState==FileReader.DONE&&function(e,a,o){i=Math.ceil(a.byteLength/r);for(var c=0;c<i;c++){var u=c*r;l[f]=a.slice(u,Math.min(u+r,a.byteLength)),n({uuid:t.uuid,buffer:l[f],currentPosition:f,maxChunks:s,size:t.size,name:t.name,lastModifiedDate:(t.lastModifiedDate||new Date).toString(),type:t.type}),f++}o()}(t.name,e.target.result,function(){(++a+1)*u<t.size?(A=t.slice(a*u,(a+1)*u),d.readAsArrayBuffer(A)):a*u<t.size?(A=t.slice(a*u,t.size),d.readAsArrayBuffer(A)):(t.url=URL.createObjectURL(t),n({currentPosition:f,uuid:t.uuid,maxChunks:s,size:t.size,name:t.name,lastModifiedDate:(t.lastModifiedDate||new Date).toString(),url:URL.createObjectURL(t),type:t.type,end:!0}))})},f+=1,A=t.slice(a*u,(a+1)*u),d.readAsArrayBuffer(A)}this.readAsArrayBuffer=function(n,t){var r=t.earlyCallback;function i(e){n.chunks[e.uuid]||(n.chunks[e.uuid]={currentPosition:-1}),t.extra=t.extra||{userid:0},e.userid=t.userid||t.extra.userid||0,e.extra=t.extra,n.chunks[e.uuid][e.currentPosition]=e,e.end&&r&&(r(e.uuid),r=null),e.maxChunks>200&&200==e.currentPosition&&r&&(r(e.uuid),r=null)}delete t.earlyCallback,e(t,i)}};n.chunks={},n.users={},n.readAsArrayBuffer=function(e,r,a){var o={file:e,earlyCallback:function(e){r(i(e,{currentPosition:-1}))},extra:a||{userid:0}};e.extra&&Object.keys(e.extra).length&&Object.keys(e.extra).forEach(function(n){o.extra[n]=e.extra[n]}),t.readAsArrayBuffer(n,o)},n.getNextChunk=function(e,t,r){var a;void 0!==e.currentPosition&&(a=e.currentPosition,e=e.uuid);var o=n.chunks[e];if(o){void 0!==r?(n.users[r+""]||(n.users[r+""]={fileUUID:e,userid:r,currentPosition:-1}),void 0!==a&&(n.users[r+""].currentPosition=a),n.users[r+""].currentPosition++,a=n.users[r+""].currentPosition):(void 0!==a&&(n.chunks[e].currentPosition=a),n.chunks[e].currentPosition++,a=n.chunks[e].currentPosition);var c=o[a];if(!c)return delete n.chunks[e],void n.convertToArrayBuffer({chunkMissing:!0,currentPosition:a,uuid:e},t);c=i(c),void 0!==r&&(c.remoteUserId=r+""),c.start&&n.onBegin(c),c.end&&n.onEnd(c),n.onProgress(c),n.convertToArrayBuffer(c,function(e){c.currentPosition!=c.maxChunks?t(e,!1):t(e,!0)})}};var r=new function(e){var n=this;n.chunks={},n.chunksWaiters={},n.receive=function t(r,i){if(r.uuid){if(r.start&&!n.chunks[r.uuid]&&(n.chunks[r.uuid]={},e.onBegin&&e.onBegin(r)),!r.end&&r.buffer&&(n.chunks[r.uuid][r.currentPosition]=r.buffer),r.end){var a=n.chunks[r.uuid],o=[];Object.keys(a).forEach(function(e,n){o.push(a[e])});var c=new Blob(o,{type:r.type});(c=function(e,n){if(e||(e={}),!n)return e;for(var t in n)try{e[t]=n[t]}catch(e){}return e}(c,r)).url=URL.createObjectURL(c),c.uuid=r.uuid,c.size||console.error("Something went wrong. Blob Size is 0."),e.onEnd&&e.onEnd(c),delete n.chunks[r.uuid],delete n.chunksWaiters[r.uuid]}r.buffer&&e.onProgress&&e.onProgress(r),r.end||(i(r),n.chunksWaiters[r.uuid]=function(){setTimeout(function e(){r.buffer&&n.chunks[r.uuid]&&(r.currentPosition==r.maxChunks||n.chunks[r.uuid][r.currentPosition]||(i(r),setTimeout(e,5e3)))},5e3)},n.chunksWaiters[r.uuid]())}else e.convertToObject(r,function(e){t(e)})}}(n);function i(e,n){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var t in n=n||new e.constructor,e)n[t]=void 0===n[t]?i(e[t],null):n[t];return n}n.addChunk=function(e,t){e&&r.receive(e,function(e){n.convertToArrayBuffer({readyForNextChunk:!0,currentPosition:e.currentPosition,uuid:e.uuid},t)})},n.chunkMissing=function(e){delete r.chunks[e.uuid],delete r.chunksWaiters[e.uuid]},n.onBegin=function(){},n.onEnd=function(){},n.onProgress=function(){},n.convertToObject=e.ConvertToObject,n.convertToArrayBuffer=e.ConvertToArrayBuffer,n.setMultipleUsers=function(){}}}();
function hark(e,t){var n=window.webkitAudioContext||window.AudioContext,i=this;if(i.events={},i.on=function(e,t){i.events[e]=t},i.emit=function(){i.events[arguments[0]]&&i.events[arguments[0]](arguments[1],arguments[2],arguments[3],arguments[4])},!n)return i;var o=(t=t||{}).smoothing||.1,a=t.interval||50,s=t.threshold,r=t.play,g=t.history||10,u=!0;window.audioContext00||(window.audioContext00=new n);var p,c,f,k=audioContext00.createGain();k.connect(audioContext00.destination),k.gain.value=0,(f=audioContext00.createAnalyser()).fftSize=512,f.smoothingTimeConstant=o,c=new Float32Array(f.fftSize),p=audioContext00.createMediaStreamSource(e),s=s||-50,p.connect(f),r&&f.connect(audioContext00.destination),i.speaking=!1,i.setThreshold=function(e){s=e},i.setInterval=function(e){a=e},i.stop=function(){u=!1,i.emit("volume_change",-100,s),i.speaking&&(i.speaking=!1,i.emit("stopped_speaking"))},i.speakingHistory=[];for(var d=0;d<g;d++)i.speakingHistory.push(0);var v=function(){setTimeout(function(){if(u){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var i=4,o=t.length;i<o;i++)t[i]>n&&t[i]<0&&(n=t[i]);return n}(f,c);i.emit("volume_change",e,s);var t=0;if(e>s&&!i.speaking){for(var n=i.speakingHistory.length-3;n<i.speakingHistory.length;n++)t+=i.speakingHistory[n];t>=2&&(i.speaking=!0,i.emit("speaking"))}else if(e<s&&i.speaking){for(var o=0;o<i.speakingHistory.length;o++)t+=i.speakingHistory[o];0===t&&(i.speaking=!1,i.emit("stopped_speaking"))}i.speakingHistory.shift(),i.speakingHistory.push(0+(e>s)),v()}},a)};return v(),i}